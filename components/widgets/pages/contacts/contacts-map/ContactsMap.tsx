import React, { useEffect, useMemo, useState } from 'react';
import { YMaps, Map, Placemark, Polygon, YMapsApi } from 'react-yandex-maps';
import { useAppSelector } from '../../../../../hook';
import SvgIcons from '../../../../svgs/SvgIcons';
import styles from './ContactsMap.module.scss';

export interface IContactsMap {}

const ContactsMap: React.FC<IContactsMap> = () => {
    const { coordinates } = useAppSelector((state) => state.main.contacts);
    const width = useAppSelector((state) => state.main.width);
    const { tablet } = useAppSelector((state) => state.main.breakpoint);
    const [ymaps, setYmaps] = useState<YMapsApi | null>(null);
    const [zoom, setZoom] = useState<number>(15);

    useEffect(() => {
        if (!width) return;
        setZoom(width > tablet ? 15 : 14);
    }, [width]);

    const iconRepublicLayout = useMemo(
        () =>
            ymaps?.templateLayoutFactory.createClass(
                `<div class="placemark_republic_layout_container">
                    <div class="square_layout">
                        <svg width="88" height="20" viewBox="0 0 88 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8.15683 6.12819C8.15323 5.26585 7.81551 4.44008 7.21756 3.83161C6.61961 3.22313 5.81015 2.88151 4.96632 2.88152H3.0458V9.37289H4.94108C5.35875 9.3742 5.77255 9.29122 6.15877 9.12872C6.54499 8.96622 6.89602 8.72739 7.19172 8.42593C7.48742 8.12448 7.72196 7.76633 7.88192 7.37203C8.04187 6.97773 8.12408 6.55504 8.12382 6.12819H8.15683ZM7.49077 11.3316L10.4036 19.7261H7.57815L4.84204 11.9468H3.05163V19.7261H0.5V0.277832H4.94691C6.23741 0.269998 7.4923 0.70998 8.50629 1.5258C9.52029 2.34162 10.2333 3.48497 10.5288 4.7688C10.8242 6.05264 10.6846 7.40094 10.1327 8.59312C9.58085 9.78531 8.6494 10.7508 7.49077 11.3316Z" fill="#F9F5F3"/>
                            <path d="M21.9578 0.279815H12.3125V19.7241H21.9578V17.1244H14.8641V11.9468H21.3267V9.37289H14.8641V2.88152H21.9578V0.279815Z" fill="#F9F5F3" />
                            <path d="M31.2458 6.1282C31.2417 5.26704 30.9046 4.44247 30.308 3.83428C29.7114 3.22609 28.9038 2.88361 28.0611 2.88152H26.1328V9.3729H28.0281C28.4457 9.37394 28.8594 9.29078 29.2455 9.12819C29.6316 8.96559 29.9825 8.72676 30.2781 8.42536C30.5738 8.12395 30.8084 7.7659 30.9684 7.37172C31.1284 6.97754 31.2108 6.55496 31.2108 6.1282H31.2458ZM28.0611 11.9468H26.1328V19.7261H23.589V0.277834H28.0358C28.7853 0.27614 29.5278 0.425326 30.2209 0.716871C30.9139 1.00842 31.544 1.43661 32.0751 1.97701C32.6063 2.51741 33.028 3.15944 33.3164 3.86642C33.6047 4.5734 33.754 5.33151 33.7557 6.09744C33.7573 6.86338 33.6113 7.62215 33.3261 8.33043C33.0408 9.03871 32.6218 9.68263 32.093 10.2254C31.5642 10.7682 30.936 11.1993 30.2442 11.4939C29.5524 11.7886 28.8106 11.9411 28.0611 11.9428" fill="#F9F5F3"/>
                            <path d="M45.6312 14.8105C45.6312 16.1868 45.0962 17.5068 44.1439 18.48C43.1916 19.4532 41.9 20 40.5532 20C39.2064 20 37.9148 19.4532 36.9625 18.48C36.0102 17.5068 35.4752 16.1868 35.4752 14.8105C35.4752 9.95634 35.5004 5.128 35.5004 0.273859H38.0249V14.8105C38.0432 15.4862 38.3187 16.128 38.7929 16.5994C39.267 17.0707 39.9024 17.3345 40.5639 17.3345C41.2254 17.3345 41.8608 17.0707 42.3349 16.5994C42.8091 16.128 43.0846 15.4862 43.1029 14.8105V0.273859H45.6545C45.6545 6.09446 45.6293 3.38559 45.6293 14.8105" fill="#F9F5F3"/>
                            <path d="M51.8433 10.6331H49.9228V17.1244H51.8181C52.2416 17.1367 52.6633 17.0623 53.0583 16.9055C53.4532 16.7488 53.8136 16.5128 54.118 16.2116C54.4224 15.9104 54.6648 15.55 54.8309 15.1517C54.997 14.7533 55.0834 14.325 55.0851 13.892C55.0868 13.4589 55.0037 13.0299 54.8407 12.6302C54.6777 12.2305 54.4381 11.8682 54.1361 11.5645C53.834 11.2608 53.4755 11.022 53.0818 10.862C52.688 10.7021 52.2669 10.6242 51.8433 10.6331ZM51.8433 2.88152H49.9228V8.05914H51.8181C52.4938 8.05914 53.1419 7.78522 53.6203 7.29748C54.0986 6.80974 54.3681 6.14799 54.3697 5.45743C54.3717 5.11804 54.3079 4.78162 54.1817 4.46767C54.0556 4.15371 53.8697 3.86846 53.6349 3.62848C53.4001 3.38849 53.1209 3.19855 52.8137 3.06964C52.5065 2.94074 52.1773 2.87545 51.8452 2.87756L51.8433 2.88152ZM51.8452 19.7222H47.3789V0.273859H51.8258C52.4936 0.270725 53.1554 0.402172 53.7734 0.660673C54.3914 0.919175 54.9535 1.29966 55.4275 1.78037C55.9015 2.26108 56.278 2.83257 56.5357 3.46216C56.7934 4.09174 56.927 4.76706 56.9291 5.44949C56.9295 6.16123 56.7846 6.86522 56.5038 7.51651C56.2229 8.1678 55.8122 8.75207 55.2979 9.23199C56.2515 9.96982 56.9543 10.9951 57.307 12.1631C57.6598 13.3311 57.6446 14.5829 57.2638 15.7416C56.8829 16.9003 56.1555 17.9076 55.1843 18.6211C54.2131 19.3346 53.0472 19.7184 51.8511 19.7182" fill="#F9F5F3"/>
                            <path d="M59.1836 19.7241V0.279815H61.7352V17.1224H65.8404V19.7241H59.1836Z" fill="#F9F5F3"/>
                            <path d="M82.8066 19.994C82.1398 19.998 81.4788 19.8669 80.8619 19.6084C80.2449 19.3498 79.6842 18.969 79.2121 18.4878C78.74 18.0066 78.3658 17.4345 78.1111 16.8047C77.8565 16.175 77.7265 15.4999 77.7285 14.8184V5.18952C77.7285 3.81317 78.2636 2.4932 79.2159 1.51997C80.1682 0.54675 81.4598 0 82.8066 0C84.1533 0 85.445 0.54675 86.3973 1.51997C87.3496 2.4932 87.8846 3.81317 87.8846 5.18952H85.3601C85.3601 4.49793 85.0913 3.83466 84.6128 3.34563C84.1343 2.8566 83.4852 2.58186 82.8085 2.58186C82.1318 2.58186 81.4827 2.8566 81.0042 3.34563C80.5257 3.83466 80.2569 4.49793 80.2569 5.18952V14.8184C80.2475 15.1652 80.3062 15.5104 80.4296 15.8336C80.553 16.1568 80.7385 16.4514 80.9752 16.7001C81.2119 16.9488 81.495 17.1464 81.8077 17.2814C82.1204 17.4164 82.4564 17.4859 82.7959 17.4859C83.1354 17.4859 83.4714 17.4164 83.7841 17.2814C84.0968 17.1464 84.3799 16.9488 84.6166 16.7001C84.8533 16.4514 85.0388 16.1568 85.1622 15.8336C85.2856 15.5104 85.3443 15.1652 85.3349 14.8184H87.8846C87.8866 15.4999 87.7566 16.175 87.502 16.8047C87.2473 17.4345 86.8732 18.0066 86.401 18.4878C85.9289 18.969 85.3682 19.3498 84.7512 19.6084C84.1343 19.8669 83.4734 19.998 82.8066 19.994Z" fill="#F9F5F3"/>
                            <path d="M67.6152 19.7261V17.1244H68.0891C68.765 17.125 69.4134 16.8512 69.8918 16.3634C70.3703 15.8755 70.6396 15.2134 70.6407 14.5227V3.51855C70.6402 3.34942 70.5741 3.18739 70.4568 3.06798C70.3396 2.94857 70.1809 2.88152 70.0154 2.88152H67.59V0.281799H76.2158V2.88152H73.8157C73.6503 2.88152 73.4918 2.94864 73.3749 3.0681C73.258 3.18757 73.1923 3.3496 73.1923 3.51855V14.5227C73.1926 14.8648 73.2588 15.2035 73.3872 15.5194C73.5156 15.8353 73.7036 16.1223 73.9406 16.3639C74.1776 16.6056 74.4588 16.7971 74.7682 16.9276C75.0776 17.0581 75.4092 17.125 75.7439 17.1244H76.2158V19.7261H67.6152Z" fill="#F9F5F3"/>
                        </svg>
                    </div>
                </div>`,
            ),
        [ymaps],
    );

    const iconBelorusskayaLayout = useMemo(
        () =>
            ymaps?.templateLayoutFactory.createClass(
                `<div class="placemark_belorusskaya_layout_container">
                    <div class="placemark_belorusskaya_wrapper">
                        <svg width="115" height="16" viewBox="0 0 115 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M27.7158 12.2842H30.0674C30.2679 12.2842 30.4411 12.2386 30.5869 12.1475C30.7373 12.0518 30.8535 11.9196 30.9355 11.751C31.0176 11.5778 31.0586 11.3773 31.0586 11.1494V10.7529C31.0586 10.516 31.0176 10.3109 30.9355 10.1377C30.8581 9.95996 30.7441 9.82552 30.5938 9.73438C30.4434 9.63867 30.2679 9.59082 30.0674 9.59082H27.7158V7.875H30.1973C30.7441 7.875 31.2181 7.98438 31.6191 8.20312C32.0202 8.42188 32.3301 8.73405 32.5488 9.13965C32.7676 9.54069 32.877 10.0146 32.877 10.5615V11.3477C32.877 11.8854 32.7676 12.3548 32.5488 12.7559C32.3301 13.1569 32.0179 13.4645 31.6123 13.6787C31.2113 13.8929 30.7396 14 30.1973 14H27.7158V12.2842ZM26.8545 4.06055H28.6387V14H26.8545V4.06055ZM27.7021 4.06055H32.2891V5.77637H27.7021V4.06055ZM34.8657 4.06055H36.6498V14H34.8657V4.06055ZM35.5766 12.2705H40.4028V14H35.5766V12.2705ZM35.5766 8.19629H39.8559V9.92578H35.5766V8.19629ZM35.5766 4.06055H40.4028V5.79004H35.5766V4.06055ZM42.0565 12.291C42.2889 12.291 42.4849 12.2363 42.6444 12.127C42.8085 12.0176 42.9315 11.8558 43.0136 11.6416C43.0956 11.4274 43.1366 11.1654 43.1366 10.8555V4.06055H44.9208V10.9922C44.9208 11.6439 44.816 12.193 44.6063 12.6396C44.4012 13.0863 44.0936 13.4258 43.6835 13.6582C43.2779 13.8861 42.7789 14 42.1864 14H42.0565V12.291ZM46.9442 4.06055H48.7284V14H46.9442V4.06055ZM44.2098 4.06055H47.7782V5.77637H44.2098V4.06055ZM53.9779 14.1025C53.3535 14.1025 52.8089 13.9818 52.3441 13.7402C51.8792 13.4941 51.5215 13.1455 51.2708 12.6943C51.0202 12.2432 50.8948 11.7122 50.8948 11.1016V6.95898C50.8948 6.34831 51.0202 5.81738 51.2708 5.36621C51.5215 4.91048 51.8792 4.56185 52.3441 4.32031C52.8089 4.07878 53.3535 3.95801 53.9779 3.95801C54.6068 3.95801 55.1536 4.07878 55.6185 4.32031C56.0833 4.56185 56.4411 4.91048 56.6917 5.36621C56.9424 5.81738 57.0677 6.34831 57.0677 6.95898V11.1016C57.0677 11.7122 56.9424 12.2432 56.6917 12.6943C56.4411 13.1455 56.0833 13.4941 55.6185 13.7402C55.1536 13.9818 54.6068 14.1025 53.9779 14.1025ZM53.9779 12.3184C54.2331 12.3184 54.4564 12.266 54.6478 12.1611C54.8392 12.0518 54.985 11.8991 55.0853 11.7031C55.1855 11.5072 55.2357 11.277 55.2357 11.0127V7.03418C55.2357 6.77441 55.1855 6.54655 55.0853 6.35059C54.985 6.15462 54.8392 6.00423 54.6478 5.89941C54.4564 5.79004 54.2331 5.73535 53.9779 5.73535C53.7226 5.73535 53.4993 5.79004 53.3079 5.89941C53.1211 6.00423 52.9775 6.15462 52.8773 6.35059C52.777 6.54655 52.7269 6.77441 52.7269 7.03418V11.0127C52.7269 11.277 52.777 11.5072 52.8773 11.7031C52.9775 11.8991 53.1211 12.0518 53.3079 12.1611C53.4993 12.266 53.7226 12.3184 53.9779 12.3184ZM60.0476 8.42871H62.5154C62.6977 8.42871 62.8549 8.3877 62.9871 8.30566C63.1238 8.21908 63.2286 8.09831 63.3015 7.94336C63.379 7.78841 63.4177 7.6084 63.4177 7.40332V6.82227C63.4177 6.60807 63.3813 6.4235 63.3084 6.26855C63.2354 6.10905 63.1306 5.98828 62.9939 5.90625C62.8617 5.81966 62.7022 5.77637 62.5154 5.77637H60.0476V4.06055H62.5154C63.0714 4.06055 63.5545 4.16764 63.9646 4.38184C64.3793 4.59147 64.6961 4.89681 64.9148 5.29785C65.1381 5.69434 65.2498 6.16146 65.2498 6.69922V7.5332C65.2498 8.06641 65.1381 8.52897 64.9148 8.9209C64.6915 9.31283 64.3748 9.61589 63.9646 9.83008C63.5545 10.0397 63.0714 10.1445 62.5154 10.1445H60.0476V8.42871ZM59.2273 4.06055H61.0115V14H59.2273V4.06055ZM67.2248 4.06055H69.1184L71.2375 11.3135L70.1096 12.7012L67.2248 4.06055ZM71.7434 12.1406C71.6158 12.5645 71.4449 12.9222 71.2307 13.2139C71.0165 13.5055 70.7544 13.7266 70.4445 13.877C70.1346 14.0273 69.7746 14.1025 69.3645 14.1025H68.4416V12.3594H69.1594C69.3553 12.3594 69.5308 12.3161 69.6857 12.2295C69.8407 12.1383 69.9729 12.0085 70.0822 11.8398C70.1962 11.6667 70.2873 11.457 70.3557 11.2109L72.215 4.06055H74.0334L71.7434 12.1406ZM78.2301 14.1025C77.6012 14.1025 77.0635 13.9818 76.6168 13.7402C76.1702 13.4941 75.8284 13.1387 75.5914 12.6738C75.3545 12.209 75.236 11.6462 75.236 10.9854V7.08203C75.236 6.42122 75.3545 5.8584 75.5914 5.39355C75.8284 4.92415 76.1702 4.56868 76.6168 4.32715C77.0635 4.08105 77.6012 3.95801 78.2301 3.95801C78.8499 3.95801 79.3717 4.08105 79.7955 4.32715C80.2194 4.57324 80.5475 4.94694 80.7799 5.44824C81.0169 5.94499 81.1582 6.57617 81.2038 7.3418H79.3717C79.3444 6.98177 79.2829 6.68555 79.1871 6.45312C79.096 6.2207 78.9707 6.04753 78.8112 5.93359C78.6517 5.8151 78.458 5.75586 78.2301 5.75586C77.9886 5.75586 77.7812 5.80827 77.608 5.91309C77.4349 6.01335 77.3027 6.16374 77.2116 6.36426C77.1204 6.56022 77.0748 6.79948 77.0748 7.08203V10.9854C77.0748 11.2679 77.1204 11.5072 77.2116 11.7031C77.3027 11.8991 77.4349 12.0495 77.608 12.1543C77.7812 12.2546 77.9886 12.3047 78.2301 12.3047C78.458 12.3047 78.6517 12.2477 78.8112 12.1338C78.9752 12.0199 79.1028 11.8467 79.194 11.6143C79.2897 11.3773 79.3489 11.0788 79.3717 10.7188H81.2038C81.1536 11.4844 81.0123 12.1178 80.7799 12.6191C80.5475 13.1159 80.2194 13.4873 79.7955 13.7334C79.3717 13.9795 78.8499 14.1025 78.2301 14.1025ZM86.0499 14.1025C85.421 14.1025 84.8832 13.9818 84.4366 13.7402C83.99 13.4941 83.6482 13.1387 83.4112 12.6738C83.1742 12.209 83.0557 11.6462 83.0557 10.9854V7.08203C83.0557 6.42122 83.1742 5.8584 83.4112 5.39355C83.6482 4.92415 83.99 4.56868 84.4366 4.32715C84.8832 4.08105 85.421 3.95801 86.0499 3.95801C86.6697 3.95801 87.1915 4.08105 87.6153 4.32715C88.0391 4.57324 88.3673 4.94694 88.5997 5.44824C88.8367 5.94499 88.9779 6.57617 89.0235 7.3418H87.1915C87.1641 6.98177 87.1026 6.68555 87.0069 6.45312C86.9158 6.2207 86.7904 6.04753 86.6309 5.93359C86.4714 5.8151 86.2777 5.75586 86.0499 5.75586C85.8083 5.75586 85.601 5.80827 85.4278 5.91309C85.2546 6.01335 85.1225 6.16374 85.0313 6.36426C84.9402 6.56022 84.8946 6.79948 84.8946 7.08203V10.9854C84.8946 11.2679 84.9402 11.5072 85.0313 11.7031C85.1225 11.8991 85.2546 12.0495 85.4278 12.1543C85.601 12.2546 85.8083 12.3047 86.0499 12.3047C86.2777 12.3047 86.4714 12.2477 86.6309 12.1338C86.795 12.0199 86.9226 11.8467 87.0137 11.6143C87.1095 11.3773 87.1687 11.0788 87.1915 10.7188H89.0235C88.9734 11.4844 88.8321 12.1178 88.5997 12.6191C88.3673 13.1159 88.0391 13.4873 87.6153 13.7334C87.1915 13.9795 86.6697 14.1025 86.0499 14.1025ZM93.6304 8.55859L95.3667 4.06055H97.315L94.9634 9.76172L93.6304 8.55859ZM93.6099 9.61133L95.1822 8.76367L97.732 14H95.6675L93.6099 9.61133ZM90.9849 4.06055H92.7691V14H90.9849V4.06055ZM91.7642 8.20312H94.8404V9.91895H91.7642V8.20312ZM101.443 4.06055H102.633L105.723 14H103.87L102.038 7.34863L100.206 14H98.3603L101.443 4.06055ZM100.076 10.7324H104.048V12.4277H100.076V10.7324ZM109.632 10.1719C109.081 10.1719 108.602 10.0625 108.197 9.84375C107.791 9.62044 107.477 9.30371 107.253 8.89355C107.035 8.47884 106.925 7.99349 106.925 7.4375V6.71973C106.925 6.17741 107.035 5.70573 107.253 5.30469C107.472 4.89909 107.784 4.58919 108.19 4.375C108.6 4.16081 109.081 4.05371 109.632 4.05371H111.984V5.76953H109.865C109.637 5.76953 109.439 5.81738 109.27 5.91309C109.106 6.00879 108.978 6.14779 108.887 6.33008C108.801 6.51237 108.757 6.72656 108.757 6.97266V7.25293C108.757 7.49902 108.803 7.71322 108.894 7.89551C108.985 8.0778 109.113 8.2168 109.277 8.3125C109.441 8.4082 109.637 8.45605 109.865 8.45605H111.984V10.1719H109.632ZM108.942 9.65234L110.678 9.9668L108.894 14H106.891L108.942 9.65234ZM111.122 4.05371H112.913V14H111.122V4.05371Z" fill="#393D46"/>
                            <circle cx="8" cy="8" r="8" fill="#393D46"/>
                            <path d="M12.2473 10.1642L9.8726 4.05053H9.77155L8.05365 7.38526L6.28523 4L3.85997 10.1642H3.20312V10.6189H6.63891V10.1642H5.98207L6.63891 8.24421L8.05365 10.6189L9.41786 8.24421L10.0747 10.1642H9.41786V10.6189H12.8031V10.1642H12.2473Z" fill="#F9F5F3"/>
                        </svg>
                    </div>
                </div>`,
            ),
        [ymaps],
    );

    return (
        <div className={styles.mapWrapper}>
            <div className={styles.map}>
                <YMaps
                    query={{
                        load: 'package.full',
                        apikey: process.env.REACT_APP_YMAPS_APIKEY,
                    }}
                >
                    <Map
                        width='100%'
                        height='100%'
                        onLoad={(ymaps) => setYmaps(ymaps)}
                        state={{
                            zoom: zoom,
                            center: width > tablet ? coordinates : [55.77453083129319, 37.57868425662907],
                            controls: ['zoomControl'],
                            behaviors: ["disable('scrollZoom')", 'drag'],
                        }}
                        options={{
                            yandexMapDisablePoiInteractivity: true,
                        }}
                        modules={['templateLayoutFactory', 'Placemark']}
                    >
                        {/* Локация */}
                        <Polygon
                            geometry={[
                                [
                                    [55.771819886805076, 37.5681915677757],
                                    [55.772055747653916, 37.570224682209],
                                    [55.771762433304296, 37.570535818454736],
                                    [55.77313827008765, 37.574376741764056],
                                    [55.772911487161615, 37.576098719951624],
                                    [55.773238054155314, 37.577112594959246],
                                    [55.77466917083949, 37.57603291673223],
                                    [55.77286550954671, 37.5673927748735],
                                    [55.77181926591135, 37.568192073159885],
                                ],
                            ]}
                            options={{
                                fillColor: 'rgba(173, 124, 83, 0.8)',
                                strokeColor: 'rgba(173, 124, 83, 0.8)',
                            }}
                        />

                        {/* Маркер Republic */}
                        <Placemark geometry={[55.77344, 37.573527]} options={{ iconLayout: iconRepublicLayout }} />

                        {/* Маркер Белорусская */}
                        <Placemark geometry={[55.776545, 37.583506]} options={{ iconLayout: iconBelorusskayaLayout }} />
                    </Map>
                </YMaps>

                <div className={styles.zoomButtons}>
                    <button onClick={() => setZoom(zoom - 1)} className={styles.btn}>
                        <SvgIcons id='minus' />
                    </button>
                    <button onClick={() => setZoom(zoom + 1)} className={styles.btn}>
                        <SvgIcons id='plus' />
                    </button>
                </div>
            </div>
        </div>
    );
};

export default ContactsMap;
